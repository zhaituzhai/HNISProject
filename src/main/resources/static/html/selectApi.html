<html>
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="../boot.js"></script>
<base href="<%=basePath%>">

<title>Api配置</title>


</head>

<body>
	<table style="width: 100%;">
		<tr>
			<td colspan="1" >可配置Api</td>
			<td></td>
			<td colspan="1">已配置Api</td>
		</tr>
		<tr>
			<td><input id="condition" type="text" style="width: 300px;" /><input
				type="submit" value="过虑" style="width: 50px;" id = "conditionSubmit"></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td><select id="select1" multiple="multiple"
				style="width: 350px; height: 250px; overflow-x: scroll">
			</select></td>
			<td width="100px" align="center"><input id="copyRight"
				type="button" value=">>" /></br> <input id="copyLeft" type="button"
				value="<<" /></td>
			<td><select id="select2" multiple="multiple"
				style="width: 350px; height: 250px; overflow-x: scroll">
			</select></td>
		</tr>

	</table>

</body>
</html>
<script>
	$(function() {

		function GetQueryString(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
			var r = window.location.search.substr(1).match(reg);
			if (r != null)
				return unescape(r[2]);
			return null;
		}

		var functionId = GetQueryString("Id");
		$.get("/auth/sysFuncApiRelation/getFuncApiListByFuncId?functionId="
				+ functionId, function(result) {
			
			if (result.success) {
				for (var i = 0; i < result.value.length; i++) {
					var text = result.value[i].apiName + " "
							+ result.value[i].apiUrl;
					var value = result.value[i].sysApiId;
					if (result.value[i].functionId == null) {
						$("#select1").append(
								"<option value='"+value+"'>" + text
										+ "</option>");
					} else {
						$("#select2").append(
								"<option value='"+value+"'>" + text
										+ "</option>");
					}

				}
			}
		});

		//将选中的复制到右侧
		$("#copyRight").click(function() {
			//获取所有选中option
			var $options = $("#select1 option:selected");
			var apiIds = '';
			$options.each(function() {
				apiIds = apiIds + this.value + ",";
			});

			$.post('/auth/sysFuncApiRelation/addApis', {
				functionId : functionId,
				apiIds : apiIds
			}).done(function(data) {
				if(data.success){
					//删除select中选中的option
					var $remove = $options.remove();
					//将选中的option添加到select2中
					$remove.appendTo('#select2');
				}
				
			}).fail(function(data) {
				alert('失败！'+data.responseJSON.message);
			});

		});

		//将左侧复制到右侧
		$("#copyLeft").click(function() {
			var apiIds = '';
			var $optino = $("#select2 option:selected");
			
			$optino.each(function() {
				apiIds = apiIds + this.value + ",";
			});
			
			$.post('/auth/sysFuncApiRelation/delApis', {
				functionId : functionId,
				apiIds : apiIds
			}).done(function(data) {
				if(data.success){
					//删除select中选中的option
					var $remove = $optino.remove();
					$remove.appendTo('#select1');
				}
				
			}).fail(function(data) {
				alert('失败！'+data.responseJSON.message);
			});
			
		});
		
		$("#conditionSubmit").click(function () {
			var condition = $("#condition").val();
			
			$.get("/auth/sysFuncApiRelation/getFuncApiListByFuncIdAndCondition?functionId="
					+ functionId+"&condition="+condition, function(conditionResult) {
				
				if (conditionResult.success) {
					document.getElementById("select1").options.length=0;
					for (var i = 0; i < conditionResult.value.length; i++) {
						var text = conditionResult.value[i].apiName + " "
								+ conditionResult.value[i].apiUrl;
						var value = conditionResult.value[i].sysApiId;
						if (conditionResult.value[i].functionId == null) {
							$("#select1").append(
									"<option value='"+value+"'>" + text
											+ "</option>");
						}
					}
				}
			});
		})
		
	});

	function getSelectedValue(opthins) {
		opthins.each(function() {
			alert(this.val());
		});
	}
	
	

	

</script>
