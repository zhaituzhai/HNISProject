<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="utf-8">
        <title>疾病库管理-编辑</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        <link rel="stylesheet" href="./css/x-admin.css" media="all">
    </head>
    
    <body>
        <div class="x-body">
			<form class="layui-form">
				<div class="layui-form-item">
					<label for="L_email" class="layui-form-label">疾病编号:</label>
					<div class="layui-input-inline">
						<input type="text" id="diseaseId" name="diseaseId" placeholder="录入不需填写" readonly="readonly" class="layui-input">
					</div>
					<div class="layui-form-mid layui-word-aux">
						<span class="x-red">*</span>
					</div>
				</div>
				<div class="layui-form-item">
					<label for="L_email" class="layui-form-label">所属科室:</label>
					<div class="layui-input-inline">
						<input type="text" id="department" name="department" placeholder="科室" class="layui-input">
					</div>
					<div class="layui-form-mid layui-word-aux">
						<span class="x-red">*</span>
					</div>
				</div>
				<div class="layui-form-item">
					<label for="L_email" class="layui-form-label">所属类别:</label>
					<div class="layui-input-inline">
					    <input type="text" id="diseaseType" name="diseaseType" placeholder="科室" class="layui-input">
					</div>
					<div class="layui-form-mid layui-word-aux">
						<span class="x-red">*</span>
					</div>
				</div>
				<div class="layui-form-item">
					<label for="L_email" class="layui-form-label">疾病名字:</label>
					<div class="layui-input-inline">
						<input type="text" id="diseaseName" name="diseaseName" required="required" lay-verify="nikename" class="layui-input">
					</div>
					<div class="layui-form-mid layui-word-aux">
						<span class="x-red">*</span>
					</div>
				</div>
				<div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">疾病描述:</label>
				    <div class="layui-input-block">
				      <textarea id="deseaseDescription" name="deseaseDescription" class="layui-textarea" placeholder="请输入内容，请不要出现转换符号"></textarea>
				    </div>
			  	</div>
				<div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">病发表现:</label>
				    <div class="layui-input-block">
				      <textarea id="deseaseManifestation" name="deseaseManifestation" class="layui-textarea" placeholder="请输入内容，请不要出现转换符号"></textarea>
				    </div>
			  	</div><div class="layui-form-item layui-form-text">
				    <label class="layui-form-label">治疗方法:</label>
				    <div class="layui-input-block">
				      <textarea id="therapeuticMethod" name="therapeuticMethod" class="layui-textarea" placeholder="请输入内容，请不要出现转换符号"></textarea>
				    </div>
			  	</div>
				<div class="layui-form-item">
					<label for="L_email" class="layui-form-label">治疗标志:</label>
					<div class="layui-input-block">
						<select id="therapeuticMark">
							<option value="到院治疗" selected="selected">到院治疗</option>
							<option value="自我治疗">自我治疗</option>
							<option value="药店咨询">药店咨询</option>
						</select>
					</div>
				</div>

				<div class="layui-form-item">
					<label for="L_pass" class="layui-form-label">录入时间:</label>
					<div class="layui-input-inline">
						<input type="text" id="entryTime" name="entryTime" placeholder="录入不需填写" readonly="readonly" lay-verify="doctorIcon" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label for="L_pass" class="layui-form-label">录入人:</label>
					<div class="layui-input-inline">
						<input type="text" id="entryPerson" name="entryPerson" required="required" lay-verify="entryPerson" class="layui-input">
					</div>
				</div>
				<div id="save" style="display: none;" class="layui-form-item">
					<label for="L_repass" class="layui-form-label">
                    </label>
					<button class="layui-btn" lay-filter="add" lay-submit="">保存</button>
				</div>
				<div id="seem" class="layui-form-item" style="display: none;">
					<label for="L_repass" class="layui-form-label">
                    </label>
					<button class="layui-btn" lay-filter="mod" lay-submit="">修改</button>
					<button class="layui-btn" lay-filter="cal" lay-submit="">取消</button>
				</div>
			</form>
		</div>
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script src="./js/x-layui.js" charset="utf-8"></script>
        <script src="lib/bootstrap/js/bootstrap.min.js"></script>
        <script charset="utf-8">
        
      //填充科室/类型
        function append_disease(){
            $.ajax({
                async: false,
                type: "post",
                contentType: "application/json;charset=UTF-8",
                url: "http://localhost:8080/dise/getDeptList",
                success:function(result){
                    if(result.success){
                        $.each(result.value,function(){
                            var optionEle = $("<option></option>").append(this).attr("value",this);
                            optionEle.appendTo("#department");
                        });
                    }
                }
            });
            $.ajax({
                async: false,
                type: "post",
                contentType: "application/json;charset=UTF-8",
                url: "http://localhost:8080/dise/getTypeList",
                success:function(result){
                    if(result.success){
                        $.each(result.value,function(){
                            var optionEle = $("<option></option>").append(this).attr("value",this);
                            optionEle.appendTo("#diseaseType");
                        });
                    }
                }
            });
        }
        
        layui.use(['form', 'layer'], function() {
		$ = layui.jquery;
		var form = layui.form(),
		layer = layui.layer;
		
		//新增按钮
		form.on('submit(add)', function(data) {
            console.log(data);
            
            var disease = {
            		"diseaseId": ""+$("#diseaseId").val(),
            		"department": ""+$("#department").val(),
                    "diseaseType": ""+$("#diseaseType").val(),
                    "diseaseName": ""+$("#diseaseName").val(),
                    "deseaseDescription": ""+$("#deseaseDescription").val(),
                    "deseaseManifestation": ""+$("#deseaseManifestation").val(),
                    "therapeuticMethod": ""+$("#therapeuticMethod").val(),
                    "therapeuticMark": ""+$("#therapeuticMark").val(),
                    "entryPerson": ""+$("#entryPerson").val()
             }
             $.ajax({
                   type: "post",
                   contentType: "application/json;charset=UTF-8",
                   url: "http://localhost:8080/dise/creatDisease",
                   data: JSON.stringify(disease),
                   success:function(result){
                      if(result.success){
                       }else{
                          alert(result.message);
                       }
                   }
             });
            
            layer.alert("提交成功", {
                icon: 6
            }, function() {
                // 获得frame索引
                var index = parent.layer.getFrameIndex(window.name);
                //关闭当前frame
                parent.layer.close(index);
                
                window.parent.to_page(parent.currentPage);//访问父页面方法 
            });
            return false;
        });
	
	      //监听提交
        form.on('submit(mod)', function(data) {
            console.log(data);
            
            var disease = {
            		"diseaseId": ""+$("#diseaseId").val(),
            		"department": ""+$("#department").val(),
                    "diseaseType": ""+$("#diseaseType").val(),
                    "diseaseName": ""+$("#diseaseName").val(),
                    "deseaseDescription": ""+$("#deseaseDescription").val(),
                    "deseaseManifestation": ""+$("#deseaseManifestation").val(),
                    "therapeuticMethod": ""+$("#therapeuticMethod").val(),
                    "therapeuticMark": ""+$("#therapeuticMark").val(),
                    "entryPerson": ""+$("#entryPerson").val()
             }
             $.ajax({
                   type: "post",
                   contentType: "application/json;charset=UTF-8",
                   url: "http://localhost:8080/dise/updateDisease",
                   data: JSON.stringify(disease),
                   success:function(result){
                      if(result.success){
                       }else{
                          alert(result.message);
                       }
                   }
             });
            
            layer.alert("提交成功", {
                icon: 6
            }, function() {
                // 获得frame索引
                var index = parent.layer.getFrameIndex(window.name);
                //关闭当前frame
                parent.layer.close(index);
                
                window.parent.to_page(parent.currentPage);//访问父页面方法 
            });
            return false;
        });
        
        form.on('submit(cal)', function() {
             // 获得frame索引
             var index = parent.layer.getFrameIndex(window.name);
             //关闭当前frame
             parent.layer.close(index);
        });
        
        var iframeOpt = parent.iframeOpt;
        //查看详情/并修改
        if(iframeOpt.method == 'seem'){
        	//append_disease();
        	$("#seem").css('display','inline-block');
            var data = iframeOpt.data;
            console.log(data);
            debugger;
            $("#diseaseId").val(data.diseaseId);
            $("#department").val(data.department);
            $("#diseaseType").val(data.diseaseType);
            $("#diseaseName").val(data.diseaseName);
            $("#deseaseDescription").val(data.deseaseDescription);
            $("#deseaseManifestation").val(data.deseaseManifestation);
            $("#therapeuticMethod").val(data.therapeuticMethod);
            $("#therapeuticMark").val(data.therapeuticMark);
            $("#entryTime").val(data.entryTime);
            $("#entryPerson").val(data.entryPerson);
            
            form.render(); //更新全部
            form.render('select'); //刷新select选择框渲染

            
        }
        //新增病例库
        if(iframeOpt.method == 'save'){
        	//append_disease();
        	$("#save").css('display','inline-block');
        	form.render(); //更新全部
            form.render('select'); //刷新select选择框渲染
        }
        
});
        </script>
    </body>

</html>